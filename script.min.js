$(document).ready(function(){var e=!1,n=!1,u=null,t=null,l=null;setInterval(function(){$.post("get.php",{},function(r){if(console.log(r),r.rolling&&!n)return e=!0,n=!0,$("#resultText .in").text(""),clearTimeout(l),$("#dice").removeClass("rolled").addClass("rolling"),r.plusNumber>0?$("#inputPlus").val("+"+r.plusNumber):$("#inputPlus").val(""),r.minusNumber>0?$("#inputMinus").val("−"+r.minusNumber):$("#inputMinus").val(""),void(t=setInterval(function(){var e=Math.floor(20*Math.random()+1);$("#dice .in").text(e)},100));r.update&&r.rolled&&r.timestamp!=u&&($("#dice").removeClass("rolling").addClass("rolled"),u=r.timestamp,r.plusNumber>0?$("#inputPlus").val("+"+r.plusNumber):$("#inputPlus").val(""),r.minusNumber>0?$("#inputMinus").val("−"+r.minusNumber):$("#inputMinus").val(""),i=!1,setTimeout(function(){e=!1,n=!1,clearInterval(t),$("#dice .in").text(r.newNumber),$("#resultText .in").text(r.newNumber-r.minusNumber+r.plusNumber)},1e3),l=setTimeout(function(){$("#dice .in").text(""),$("#resultText .in").text(""),i||($("#inputPlus").val(""),$("#inputMinus").val(""))},2e4))},"json")},1e3);var i=!1;$("#inputPlus, #inputMinus").change(function(){i=!0}),$("#rollButton").click(function(){if(!e){e=!0,$("#resultText .in").text(""),clearTimeout(l);var n=Math.floor(20*Math.random()+1),u=$("#inputMinus").val(),t=$("#inputPlus").val();console.log(n,u,t),u=parseInt(u.replace(/[^0-9]/g,"")),t=parseInt(t.replace(/[^0-9]/g,"")),u||(u=0),t||(t=0),console.log(n,u,t),$.post("save.php",{rolling:!0,rolled:!1,newNumber:n,minusNumber:u,plusNumber:t},function(e){console.log("rolling sent"),setTimeout(function(){$.post("save.php",{rolling:!1,rolled:!0,newNumber:n,minusNumber:u,plusNumber:t},function(e){console.log("update sent")})},3e3)})}}),$(".input").focus(function(e){$(e.currentTarget).select()}),$("#inputPlus").keyup(function(e){var n=$(e.currentTarget),u=Math.abs(n.val().replace(/[^0-9]/g,""));u>0?n.val("+"+u):n.val("")}),$("#inputMinus").keyup(function(e){var n=$(e.currentTarget),u=Math.abs(n.val().replace(/[^0-9]/g,""));u>0?n.val("−"+u):n.val("")})});